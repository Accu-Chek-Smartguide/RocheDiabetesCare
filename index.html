<!DOCTYPE html>
<html lang="en">
<head>
    <title>RocheDiabetesCare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r130/examples/js/loaders/RGBELoader.js"></script>
    <link rel="icon" href="https://logowik.com/content/uploads/images/798_roche.jpg" type="image/icon type">
    <link rel="stylesheet" href="Style/style.css">
</head>
<body>

    <div id="splash-screen" class="splash-screen">
        <img src="https://upload.wikimedia.org/wikipedia/commons/f/f5/Hoffmann-La_Roche_logo.svg" alt="Logo" class="logo">
    </div>

    <a-scene embedded arjs='trackingMethod: best; sourceType: webcam; debugUIEnabled: false;'>

        <a-light type="directional" intensity="1" position="1 1 0.5"></a-light>

        <a-marker type="pattern" url="https://raw.githubusercontent.com/BrunoSilvaCosta/RocheDiabetesCare/main/Images/Marker-custom.patt">
            <a-entity scale="1 1 1">
                <a-entity id="model1" gltf-model="Model/TestJPG.gltf" scale="10 10 10"></a-entity>
                <a-entity id="model2" gltf-model="Model/package.gltf" scale="10 10 10" position="0 0 0"></a-entity>
                <a-box position="0 0.5 0" opacity="0"></a-box>
            </a-entity>
        </a-marker>
        <a-entity camera></a-entity>

    </a-scene>

    <script>
        // Composant personnalisé pour charger et appliquer la HDRI
        AFRAME.registerComponent('apply-hdri-lighting', {
          init: function () {
            const sceneEl = this.el.sceneEl;
            const renderer = sceneEl.renderer;
            const pmremGenerator = new THREE.PMREMGenerator(renderer);
            pmremGenerator.compileEquirectangularShader();

            const hdrLoader = new THREE.RGBELoader();
            hdrLoader.load('Images/HDRI/brown_photostudio_01_1k.hdr', function (texture) {
              const envMap = pmremGenerator.fromEquirectangular(texture).texture;

              // Applique la map d'environnement HDRI aux modèles 3D
              sceneEl.querySelectorAll('[gltf-model]').forEach(entity => {
                entity.getObject3D('mesh').traverse(node => {
                  if (node.isMesh) {
                    node.material.envMap = envMap;
                    node.material.needsUpdate = true;
                  }
                });
              });
            });
          }
        });

        // Applique le composant à la scène
        document.querySelector('a-scene').setAttribute('apply-hdri-lighting', '');
    </script>

    <script src="Scripts/main.js"></script>
</body>
</html>
